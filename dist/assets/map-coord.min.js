(function(e){"use strict";var G=document.createElement("style");G.textContent=`body{padding:0;margin:0;box-sizing:border-box}#map-coord{--map-primary: #3d6eff;font:16px/1.65 -apple-system,BlinkMacSystemFont,Helvetica Neue,Helvetica,Arial,Roboto,PingFang SC,miui,Hiragino Sans GB,Microsoft Yahei,sans-serif}#map-coord button{border-radius:4px;white-space:nowrap;border:none;outline:none;cursor:pointer}#map-coord input{border-radius:4px;border:none;outline:none}#map-coord textarea{width:100%;height:100px;padding:10px;border-radius:4px;border:1px solid #d7d8d9;outline:none;box-shadow:none;box-sizing:border-box}.map-coord{width:100vw;height:100vh;color:#222;overflow:hidden}.map-coord #map-container{width:100%;height:100%}.map-coord__search,.map-coord__city{display:flex;align-items:center;height:32px}.map-coord__search input,.map-coord__city input{flex:1 0 0;height:100%;padding:0 10px;border-radius:4px;border:none;outline:none;border:1px solid #d7d8d9;margin-right:10px}.map-coord__search button,.map-coord__city button{padding:8px 12px;color:#fff;background-color:var(--map-primary);border-radius:4px;white-space:nowrap;border:none;outline:none;cursor:pointer}.map-coord__record-container{display:flex;flex-direction:column;gap:20px;position:fixed;left:0;top:0;z-index:10;padding:20px;width:280px;background-color:#ffffffb8;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);border-bottom-right-radius:10px;transition:width .2s ease}.map-coord__record-container.empty{width:0;height:var(--height);padding:0}.map-coord__textarea{width:100%}.map-coord__textarea-title{color:#222;font-size:13px;font-weight:700;margin-bottom:8px}.map-coord__textarea textarea{height:100px;background-color:transparent}.map-coord__records{flex:1 0 0;display:flex;flex-direction:column}.map-coord__records-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:13px;font-weight:700}.map-coord__records-title button{background-color:transparent}.map-coord__records-list{max-height:400px;margin:0;overflow-x:hidden;overflow-y:auto}.map-coord__records-list.window-scroll{body-scrollbar-gutter:stable}.map-coord__records-list.window-scroll::-webkit-scrollbar{width:8px;transition:opacity .2s}.map-coord__records-list.window-scroll::-webkit-scrollbar-thumb{background-color:#0000004d;border-radius:10px}.map-coord__records-list.window-scroll::-webkit-scrollbar-thumb:hover{background-color:#0009}.map-coord__records-list.window-scroll::-webkit-scrollbar-track{background-color:#0000004d;border-radius:10px}.map-coord__records-item{font-size:14px}.map-coord__record-control{display:flex;justify-content:center;align-items:center;position:absolute;right:-14px;top:50%;transform:translateY(-50%);width:14px;height:100px;background-color:var(--map-primary);border-top-right-radius:4px;border-bottom-right-radius:4px;box-shadow:0 2px 10px #0003;cursor:pointer}.map-coord__record-control__button{--icon-size: 14px;display:flex;justify-content:center;align-items:center}.map-coord__record-control__button svg{width:var(--icon-size);height:var(--icon-size);fill:#fff}.map-coord__record-button{position:fixed;right:10px;bottom:135px;font-size:12px;font-weight:700;color:#222;padding:10px;background-color:#ffffffb8;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.map-coord__info{display:grid;gap:20px;width:240px;position:fixed;top:0;right:0;padding:20px;z-index:10;font-size:14px;background-color:#ffffffb8;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);border-bottom-left-radius:10px}.map-coord__info label{display:block;margin-bottom:8px;font-size:13px;font-weight:700}.map-coord__info input[type=range]{display:block;width:100%;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;appearance:none}.map-coord__info input[type=range]:focus::-webkit-slider-thumb{box-shadow:0 0 0 1px #fff,0 0 0 .25rem #0d6efd40}.map-coord__info input[type=range]::-webkit-slider-thumb{width:1rem;height:1rem;margin-top:-.25rem;background-color:var(--map-primary);border:0;border-radius:1rem;transition:background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;-webkit-appearance:none;-moz-appearance:none;appearance:none}.map-coord__info input[type=range]::-webkit-slider-runnable-track{width:100%;height:.5rem;color:transparent;cursor:pointer;background-color:#dee2e6;border-color:transparent;border-radius:1rem}.map-coord__info-button{cursor:pointer}.map-coord__info-content{border-radius:10px}.map-coord__info-control-rotate{margin-bottom:10px;-webkit-user-select:none;user-select:none}.map-coord__info-control-rotate-icon{padding:0 10px;cursor:pointer}.map-coord__info-control-rotate-icon:first-child{padding-left:0}.map-coord__info-control-rotate-icon:last-child{padding-right:0}.map-coord__info-control-scale{-webkit-user-select:none;user-select:none}.map-coord__info-control-scale-icon{display:flex;justify-content:center;align-items:center;cursor:pointer;padding:2px 8px;background-color:#ccc}.map-coord__marker-label{position:fixed;left:var(--left);top:var(--top);height:32px}.map-coord__marker-label input{height:100%;border:1px solid #d7d8d9;padding:0 10px}.map-coord__dialog{width:100vw;min-width:100vw;height:100vh;min-height:100vh;background-color:#0000007a;overflow:hidden;border:none;outline:none;padding:0;margin:0;position:relative}.map-coord__dialog-container{display:grid;gap:15px;position:absolute;left:50%;top:50%;z-index:100;transform:translate(-50%,-50%);width:200px;font-size:13px;font-weight:700;color:#222;padding:20px;background-color:#ffffffb8;border-radius:10px}.map-coord__dialog-container input{height:32px;padding:0 10px}.map-coord__dialog-operate{display:flex;justify-content:flex-end;align-items:center;gap:5px}.map-coord__dialog-operate__button{padding:8px 12px;background-color:#fff}.map-coord__dialog-operate__button.confirm{color:#fff;background-color:var(--map-primary)}@media (max-width: 996px){.map-coord__record-container{right:0;left:initial;top:86px;border-radius:10px 0 0 10px}.map-coord__record-control{left:-14px;border-radius:4px 0 0 4px}.map-coord__records-list{max-height:300px}}.map-coord-upload{position:fixed;top:16px;left:50%;width:260px;margin-left:-130px}.map-coord-upload__preview{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none}.map-coord-upload__preview__image{transform:rotate(var(--rotate)) scale(var(--scale));box-shadow:0 7px 8px -4px #00000014,0 12px 17px 2px #0000000a,0 5px 22px 4px #0000000a;outline:5px solid #fff}.map-coord-upload__preview__image__corner{display:flex;justify-content:center;align-items:center;position:absolute;z-index:10;width:24px;height:24px;color:#fff;background-color:#3d6eff;font-size:12px;border-radius:50%;border:2px solid #fff;transform:rotate(calc(0deg - var(--rotate))) scale(calc(1 / var(--scale)))}.map-coord-upload__preview__image__corner:nth-child(1),.map-coord-upload__preview__image__corner:nth-child(2){top:-13px}.map-coord-upload__preview__image__corner:nth-child(3),.map-coord-upload__preview__image__corner:nth-child(4){bottom:-13px}.map-coord-upload__preview__image__corner:nth-child(1),.map-coord-upload__preview__image__corner:nth-child(3){left:-13px}.map-coord-upload__preview__image__corner:nth-child(2),.map-coord-upload__preview__image__corner:nth-child(4){right:-13px}.map-coord-upload__preview img{display:block;width:30vw;height:auto;opacity:.5}.btn--upload-image{margin:auto;display:flex;align-items:center;padding:12px 20px;font-size:14px;border-radius:10px;border:none;color:#fff;background-color:#0009;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);cursor:pointer}.btn--upload-image svg{width:24px;margin:auto 8px auto auto}
`,document.head.appendChild(G);var se=!1;/*!
 * pinia v2.2.4
 * (c) 2024 Eduardo San Martin Morote
 * @license MIT
 */let Y;const H=t=>Y=t,q=Symbol();function U(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var z;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(z||(z={}));function de(){const t=e.effectScope(!0),o=t.run(()=>e.ref({}));let a=[],r=[];const d=e.markRaw({install(c){H(d),d._a=c,c.provide(q,d),c.config.globalProperties.$pinia=d,r.forEach(m=>a.push(m)),r=[]},use(c){return!this._a&&!se?r.push(c):a.push(c),this},_p:a,_a:null,_e:t,_s:new Map,state:o});return d}const Z=()=>{};function $(t,o,a,r=Z){t.push(o);const d=()=>{const c=t.indexOf(o);c>-1&&(t.splice(c,1),r())};return!a&&e.getCurrentScope()&&e.onScopeDispose(d),d}function P(t,...o){t.slice().forEach(a=>{a(...o)})}const pe=t=>t(),ee=Symbol(),X=Symbol();function W(t,o){t instanceof Map&&o instanceof Map?o.forEach((a,r)=>t.set(r,a)):t instanceof Set&&o instanceof Set&&o.forEach(t.add,t);for(const a in o){if(!o.hasOwnProperty(a))continue;const r=o[a],d=t[a];U(d)&&U(r)&&t.hasOwnProperty(a)&&!e.isRef(r)&&!e.isReactive(r)?t[a]=W(d,r):t[a]=r}return t}const fe=Symbol();function me(t){return!U(t)||!t.hasOwnProperty(fe)}const{assign:M}=Object;function ue(t){return!!(e.isRef(t)&&t.effect)}function ge(t,o,a,r){const{state:d,actions:c,getters:m}=o,h=a.state.value[t];let S;function b(){h||(a.state.value[t]=d?d():{});const A=e.toRefs(a.state.value[t]);return M(A,c,Object.keys(m||{}).reduce((w,x)=>(w[x]=e.markRaw(e.computed(()=>{H(a);const C=a._s.get(t);return m[x].call(C,C)})),w),{}))}return S=oe(t,b,o,a,r,!0),S}function oe(t,o,a={},r,d,c){let m;const h=M({actions:{}},a),S={deep:!0};let b,A,w=[],x=[],C;const p=r.state.value[t];!c&&!p&&(r.state.value[t]={}),e.ref({});let g;function k(s){let l;b=A=!1,typeof s=="function"?(s(r.state.value[t]),l={type:z.patchFunction,storeId:t,events:C}):(W(r.state.value[t],s),l={type:z.patchObject,payload:s,storeId:t,events:C});const _=g=Symbol();e.nextTick().then(()=>{g===_&&(b=!0)}),A=!0,P(w,l,r.state.value[t])}const R=c?function(){const{state:l}=a,_=l?l():{};this.$patch(v=>{M(v,_)})}:Z;function I(){m.stop(),w=[],x=[],r._s.delete(t)}const N=(s,l="")=>{if(ee in s)return s[X]=l,s;const _=function(){H(r);const v=Array.from(arguments),O=[],D=[];function Q(V){O.push(V)}function j(V){D.push(V)}P(x,{args:v,name:_[X],store:u,after:Q,onError:j});let L;try{L=s.apply(this&&this.$id===t?this:u,v)}catch(V){throw P(D,V),V}return L instanceof Promise?L.then(V=>(P(O,V),V)).catch(V=>(P(D,V),Promise.reject(V))):(P(O,L),L)};return _[ee]=!0,_[X]=l,_},B={_p:r,$id:t,$onAction:$.bind(null,x),$patch:k,$reset:R,$subscribe(s,l={}){const _=$(w,s,l.detached,()=>v()),v=m.run(()=>e.watch(()=>r.state.value[t],O=>{(l.flush==="sync"?A:b)&&s({storeId:t,type:z.direct,events:C},O)},M({},S,l)));return _},$dispose:I},u=e.reactive(B);r._s.set(t,u);const E=(r._a&&r._a.runWithContext||pe)(()=>r._e.run(()=>(m=e.effectScope()).run(()=>o({action:N}))));for(const s in E){const l=E[s];if(e.isRef(l)&&!ue(l)||e.isReactive(l))c||(p&&me(l)&&(e.isRef(l)?l.value=p[s]:W(l,p[s])),r.state.value[t][s]=l);else if(typeof l=="function"){const _=N(l,s);E[s]=_,h.actions[s]=l}}return M(u,E),M(e.toRaw(u),E),Object.defineProperty(u,"$state",{get:()=>r.state.value[t],set:s=>{k(l=>{M(l,s)})}}),r._p.forEach(s=>{M(u,m.run(()=>s({store:u,app:r._a,pinia:r,options:h})))}),p&&c&&a.hydrate&&a.hydrate(u.$state,p),b=!0,A=!0,u}function _e(t,o,a){let r,d;const c=typeof o=="function";r=t,d=c?a:o;function m(h,S){const b=e.hasInjectionContext();return h=h||(b?e.inject(q,null):null),h&&H(h),h=Y,h._s.has(r)||(c?oe(r,o,d,h):ge(r,d,h)),h._s.get(r)}return m.$id=r,m}const te=_e("map",()=>{const t=e.ref(),o=e.ref(),a=e.ref({topLeft:0,topRight:0,bottomLeft:0,bottomRight:0}),r=e.ref(),d=e.ref(0),c=e.ref(1),m=e.ref([]),h=e.ref([]),S=e.ref(new WeakMap);function b(x){var k;const p=(k=x.target.files)==null?void 0:k[0],g=new FileReader;g.onload=function(R){var I,N;(I=R.target)!=null&&I.result&&(t.value=(N=R.target)==null?void 0:N.result,e.nextTick(()=>{A()}))},p&&g.readAsDataURL(p)}function A(){if(!t.value)return;const x=r.value.getSize().width,C=r.value.getSize().height,p=x/2,g=C/2,{width:k,height:R}=w(),I=k*c.value,N=R*c.value,B=[{x:p-I/2,y:g-N/2},{x:p+I/2,y:g-N/2},{x:p-I/2,y:g+N/2},{x:p+I/2,y:g+N/2}],u=d.value*(Math.PI/180),E=B.map(({x:s,y:l})=>{const _=p+(s-p)*Math.cos(u)-(l-g)*Math.sin(u),v=g+(s-p)*Math.sin(u)+(l-g)*Math.cos(u);return{x:_,y:v}}).map(({x:s,y:l})=>r.value.containerToLngLat([s,l]));a.value={topLeft:E[0],topRight:E[1],bottomLeft:E[2],bottomRight:E[3]}}function w(){var p,g;const x=((p=o.value)==null?void 0:p.width)??0,C=((g=o.value)==null?void 0:g.height)??0;return{width:x,height:C}}return{previewImage:t,previewImageRef:o,coords:a,mapInstance:r,imgRotation:d,imgScale:c,recordCoords:m,recordCoordsKey:h,recordCoordsMap:S,upload:b,updateImageBounds:A}}),he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAjlJREFUOE+1lD9oE2EYxp/nu4vaQcV/uYouIkK6tKO6llqsi7p10YIuhepdBVEXa62LuLQ5LXRSVHAVXIJauqpjuzSgbSdLLyi6aNXcfY8mbQKxiSRQv+k+7n1+PO+f7yU2+bARL52NzxmoU2AngK71uFlCcxacKwTu03raukBvIn4Og1UIM1bKp2I3XxIX3ThjyAyIbgAm8t3+v6E1wHT4q4sy0wDHIt88aL9vhyT1AcysCZUnmVu5bCbToR0hdEm0PQV/y2wFXAP0srGiwKUXFnsgMwXocP2ScAG0g5Gfmq5oNgDLaZI50C5CfN1Ur6gTErdTOB8Nu2dLmrLD9mw8IOBU5Dv9XmjfN3a2oWILkW+OeGHyhMD0SuA+LgO9bPwQsm9AZxugsCl31SD6UPIDNMejwL1QAb6l1Q3r8BqFvlaAInIm0T0Z3o0C91gF+Jl0MpJ9B+hQK0CAS6Q5KiX5KHD3/DfgWsoG1wmebMVho5TXmgK0gSbbChCyAYDVmqaUx0boib46A96u5AOAJuvIxejLn7HZnTyjkKuOzfrovBDwCNQ3ii+bcSnH6TVJclDSmWg4dbo62KWPvePa75hkufT00mGxl+LUP5wuiRos+KlXpafnFL/vW76641MNsHRJjxdHaXhLVrcLB9w73oodotSn9eVAKC8yF7WbyfTH+GY19kpqtO5yKEMn5JHJGIidkJ0x5Dy3uvPlXfMz7rBSB2i6YdXmxKsXK84aAis/NnXBNtOQRjG/ATrNISQKnTZVAAAAAElFTkSuQmCC",be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAARxJREFUOE/lVLFKA0EUnPEuRSy00dzZWNho5Rf4LVqbwleIRYhaiViccCcI/oDgf1hbi4XY3oZUaQSTvSdrLhCi3B4cVtny7czs7NvZR9RYcWq7xQrag5Pg1genDxBltgfotcMRTHIJzqo4NQTHrwD3SpGhkXCzkWCcTZ4VOJiJGAkrTXgdzgsq+DaQYOb2T6PLKjiNRnFIcLjYGAX2AayV9U8CL78x3AKKJyOtc7rQKvXel8c6+wpesnNnT6ma1CH4MXrz88pxOk6UPAKw4aIxTyR0G0C7rH0p+LGwvwtgRPAxl6C7rLGpava/fj13cOPhEKWTdxA75S1GRsL1RuMryuwVoP3pgMVDLuFxI0FH7mT2gihWjbR6vnB/A/NqiGDufkkNAAAAAElFTkSuQmCC",xe={xmlns:"http://www.w3.org/2000/svg",class:"icon",viewBox:"0 0 1024 1024"};function we(t,o){return e.openBlock(),e.createElementBlock("svg",xe,o[0]||(o[0]=[e.createElementVNode("path",{fill:"#fff",d:"M503.467 490.667 678.4 665.6l-59.733 59.733L384 490.667 618.667 256l59.733 59.733z"},null,-1)]))}const re={render:we},ke={xmlns:"http://www.w3.org/2000/svg",class:"icon",viewBox:"0 0 1024 1024"};function ye(t,o){return e.openBlock(),e.createElementBlock("svg",ke,o[0]||(o[0]=[e.createElementVNode("path",{fill:"#fff",d:"M558.933 490.667 384 665.6l59.733 59.733L678.4 490.667 443.733 256 384 315.733z"},null,-1)]))}const ne={render:ye},Ce={class:"map-coord-upload"},Ae={class:"map-coord-upload__preview"},Ne=["src"],Ve=e.defineComponent({__name:"upload",setup(t){const o=te(),a=e.ref(),r=e.ref();return e.onMounted(()=>{o.previewImageRef=r.value}),(d,c)=>(e.openBlock(),e.createElementBlock("div",Ce,[e.createElementVNode("button",{class:"btn--upload-image",onClick:c[0]||(c[0]=(...m)=>a.value.click&&a.value.click(...m))},c[2]||(c[2]=[e.createElementVNode("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},[e.createElementVNode("path",{d:"M21 15V18H24V20H21V23H19V20H16V18H19V15H21ZM21.0082 3C21.556 3 22 3.44495 22 3.9934V13H20V5H4V18.999L14 9L17 12V14.829L14 11.8284L6.827 19H14V21H2.9918C2.44405 21 2 20.5551 2 20.0066V3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082ZM8 7C9.10457 7 10 7.89543 10 9C10 10.1046 9.10457 11 8 11C6.89543 11 6 10.1046 6 9C6 7.89543 6.89543 7 8 7Z"})],-1),e.createElementVNode("span",null,"上传地图图片",-1)])),e.createElementVNode("input",{style:{display:"none"},ref_key:"fileInputRef",ref:a,type:"file",accept:".jpg, .jpeg, .png",multiple:!1,onChange:c[1]||(c[1]=(...m)=>e.unref(o).upload&&e.unref(o).upload(...m))},null,544),e.withDirectives(e.createElementVNode("div",Ae,[e.createElementVNode("div",{class:"map-coord-upload__preview__image",style:e.normalizeStyle({"--rotate":`${e.unref(o).imgRotation}deg`,"--scale":e.unref(o).imgScale})},[c[3]||(c[3]=e.createElementVNode("span",{class:"map-coord-upload__preview__image__corner"},"A",-1)),c[4]||(c[4]=e.createElementVNode("span",{class:"map-coord-upload__preview__image__corner"},"B",-1)),c[5]||(c[5]=e.createElementVNode("span",{class:"map-coord-upload__preview__image__corner"},"C",-1)),c[6]||(c[6]=e.createElementVNode("span",{class:"map-coord-upload__preview__image__corner"},"D",-1)),e.createElementVNode("img",{ref_key:"previewImageRef",ref:r,src:e.unref(o).previewImage,alt:""},null,8,Ne)],4)],512),[[e.vShow,e.unref(o).previewImage]])]))}}),T={get:()=>JSON.parse(localStorage.getItem("map-coord-record")??"{}"),set:t=>localStorage.setItem("map-coord-record",JSON.stringify(t)),clear:()=>localStorage.setItem("map-coord-record","{}")},Ee=(t,o=300)=>{let a;return(...r)=>{a&&(clearTimeout(a),a=0),a=setTimeout(()=>{t.apply(void 0,r)},o)}},Se=(t,o=200)=>{let a;return(...r)=>{clearTimeout(a),a=setTimeout(()=>{t.apply(void 0,r)},o)}},Ie=()=>{const t=navigator.userAgent.toLowerCase();return{isMobile:/iphone|ipod|android|ios|ipad|blackberry|webos|symbian|windows phone|phone/i.test(t),isAndroid:t.indexOf("android")>-1||t.indexOf("adr")>-1,isIOS:/iphone|ipad|ipod/.test(t),isWindows:t.indexOf("windows")!==-1,hasTouch:"ontouchstart"in window||t.indexOf("touch")!==-1||t.indexOf("mobile")!==-1}},ve={class:"map-coord"},Le={class:"map-coord__textarea"},Re={key:0,class:"map-coord__records"},Me={class:"map-coord__record-control__button"},Be={class:"map-coord__info"},Oe={class:"map-coord__search"},Pe={class:"map-coord__info-content"},ze={class:"map-coord__info-content-item"},Ke={class:"map-coord__info-content-item-value"},De={class:"map-coord__info-content-item"},He={class:"map-coord__info-content-item-value"},Te={class:"map-coord__info-content-item"},je={class:"map-coord__info-content-item-value"},Fe={class:"map-coord__info-content-item"},Ue={class:"map-coord__info-content-item-value"},Xe={class:"map-coord__info-control"},We={class:"map-coord__info-control-rotate"},Qe=["value"],Je={class:"map-coord__info-control-scale"},Ge=["value"],Ye={class:"map-coord__dialog-container"},qe="f504034d371bf3d9c603654382b2ccf8",Ze="9cd7ad870c55df884c463e994a8b7476",$e=e.defineComponent({__name:"App",setup(t){const o=te(),a=Ie();let r;const d=e.ref(),c=e.ref(),m=e.ref(),h=e.ref(),S=e.ref(),b=e.ref(),A=e.ref(!1),w=e.ref(),x=e.ref(),C=e.ref(),p=e.ref([]),g=e.ref(),k=e.ref(),R=e.ref(!0),I=e.ref(),N=e.ref(),B=e.ref(),u=e.ref(),K=e.ref(""),E=e.ref(!1),s=e.ref(),l=e.ref(!0),_=e.ref();e.onMounted(()=>{Q()}),e.onBeforeUnmount(()=>{s.value&&navigator.geolocation.clearWatch(s.value)});function v(i){requestAnimationFrame(()=>{E.value||(E.value=!0);const{latitude:n,longitude:f,accuracy:y}=i.coords;b.value.convertFrom(new b.value.LngLat(f,n),"gps",function(J,F){if(F.info==="ok"){const so=F;k.value=so.locations[0],R.value&&(I.value=L(k.value),N.value=new b.value.Circle({center:k.value,radius:y,strokeColor:"#1791fc",strokeOpacity:1,strokeWeight:3,fillColor:"#1791fc",fillOpacity:.3}),N.value.setMap(o.mapInstance),o.mapInstance.setCenter(k.value),R.value=!1),N.value.setCenter(k.value),N.value.setRadius(y),I.value.setPosition(k.value)}})})}const O=Ee(v,500);function D(){navigator.geolocation?s.value=navigator.geolocation.watchPosition(O,i=>{console.error("Error watching position:",i)},{enableHighAccuracy:!1}):console.error("Geolocation is not supported by this device.")}function Q(){window._AMapSecurityConfig={securityJsCode:Ze},window.AMapLoader.load({key:qe,version:"2.0"}).then(async i=>{o.mapInstance=new i.Map("map-container",{zoom:15}),i.plugin("AMap.ToolBar",function(){const f=new i.ToolBar({position:{right:"16px",bottom:"60px"}});o.mapInstance.addControl(f)}),i.plugin("AMap.PlaceSearch",function(){r=new i.PlaceSearch({pageSize:5,pageIndex:1,city:h.value,extensions:"all"})}),b.value=i,D(),u.value=T.get(),j();const n=Se(o.updateImageBounds,300);o.mapInstance.on("zoomchange",n),o.mapInstance.on("moveend",n)}).catch(i=>{console.error(i)})}function j(){for(let i=0;i<(u.value.length??0);i++){const n=u.value[i],f=L(new b.value.LngLat(n.lng,n.lat),"marker");p.value.push(f),n.label&&f.setLabel({content:n.label}),x.value=f,f.on("click",ae),o.recordCoordsKey.push(f),o.recordCoordsMap.set(f,n)}o.recordCoords=u.value}function L(i,n="default"){const f={marker:be,default:he},y=new b.value.Marker({position:i,icon:f[n]??f.default,anchor:"bottom-center",offset:new b.value.Pixel(0,10)});return o.mapInstance.add(y),y}function V(){m.value&&r.search(m.value,function(i,n){if(i==="complete"&&n.info==="OK"){const f=n.poiList.pois;if(f.length>0){const y=f[0],J=[y.location.lng,y.location.lat];o.mapInstance.setCenter(J),S.value&&(o.mapInstance.remove(S.value),S.value=null);const F=L(J);S.value=F}}})}function oo(i){const n=i.target;o.imgRotation=parseInt(n.value),o.updateImageBounds()}function to(i){const n=i.target;o.imgScale=n.value?Number(n.value):0,o.updateImageBounds()}function ro(){o.recordCoords=[],o.recordCoordsKey.forEach(i=>{const n=o.recordCoordsMap.get(i);n&&o.recordCoords.push(n)}),T.set(o.recordCoords)}async function ae(i){if(i.target){C.value=i.target;const n=o.recordCoordsMap.get(i.target);w.value=n==null?void 0:n.label,B.value="update",ie()}}async function no(){w.value="",B.value="create",ie()}function ce(){for(let i=0;i<p.value.length;i++)o.mapInstance.remove(p.value[i])}function ao(){ce(),p.value=[],o.recordCoordsKey=[],u.value=JSON.parse(K.value),T.set(u.value),j()}function co(){ce(),p.value=[],o.recordCoordsKey=[],o.recordCoords=[],T.clear()}async function ie(){var i;A.value=!0,await e.nextTick(),(i=g.value)==null||i.showModal()}function io(){var i;(i=g.value)==null||i.close(),A.value=!1}function le(){var n;({create(){const f=L(k.value,"marker");p.value.push(f),x.value=f,f.on("click",ae),o.recordCoordsKey.push(x.value),o.recordCoordsMap.set(x.value,{label:w.value??"",lng:k.value.lng,lat:k.value.lat}),requestAnimationFrame(()=>{var y;(y=x.value)==null||y.setLabel({content:w.value})})},update(){var f;o.recordCoordsMap.set(C.value,{...o.recordCoordsMap.get(C.value),label:w.value??""}),(f=C.value)==null||f.setLabel({content:w.value})}})[B.value??"create"](),ro(),(n=g.value)==null||n.close(),A.value=!1}function lo(){requestAnimationFrame(()=>{_.value!==Number(c.value.clientHeight)&&(_.value=Number(c.value.clientHeight)),l.value=!l.value})}return(i,n)=>{var f;return e.openBlock(),e.createElementBlock("div",ve,[n[10]||(n[10]=e.createElementVNode("div",{id:"map-container"},null,-1)),e.createVNode(Ve),e.createElementVNode("div",{ref_key:"recordContainerRef",ref:c,style:e.normalizeStyle({[_.value?"--height":""]:`${_.value}px`}),class:e.normalizeClass(["map-coord__record-container",{empty:!l.value}])},[l.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("div",Le,[n[3]||(n[3]=e.createElementVNode("div",{class:"map-coord__textarea-title"},"解析标记记录",-1)),e.withDirectives(e.createElementVNode("textarea",{placeholder:"在这里粘贴坐标记录",onInput:ao,"onUpdate:modelValue":n[0]||(n[0]=y=>K.value=y)},null,544),[[e.vModelText,K.value]])]),(f=e.unref(o).recordCoords)!=null&&f.length?(e.openBlock(),e.createElementBlock("div",Re,[e.createElementVNode("div",{class:"map-coord__records-title"},[n[4]||(n[4]=e.createElementVNode("div",null,"已标记记录",-1)),e.createElementVNode("button",{onClick:co},"清空")]),e.createElementVNode("pre",{class:e.normalizeClass(["map-coord__records-list",{"window-scroll":e.unref(a).isWindows}])},e.toDisplayString(JSON.stringify(e.unref(o).recordCoords,null,2)),3)])):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"map-coord__record-control",onClick:lo},[e.createElementVNode("div",Me,[e.unref(a).isMobile?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[l.value?(e.openBlock(),e.createBlock(e.unref(ne),{key:1})):(e.openBlock(),e.createBlock(e.unref(re),{key:0}))],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[l.value?(e.openBlock(),e.createBlock(e.unref(re),{key:0})):(e.openBlock(),e.createBlock(e.unref(ne),{key:1}))],64))])])],6),E.value?(e.openBlock(),e.createElementBlock("button",{key:0,class:"map-coord__record-button",onClick:no}," 标记当前坐标 ")):e.createCommentVNode("",!0),e.createElementVNode("div",Be,[e.createElementVNode("div",Oe,[e.withDirectives(e.createElementVNode("input",{type:"text",placeholder:"请输入关键字进行搜索","onUpdate:modelValue":n[1]||(n[1]=y=>m.value=y),onKeyup:e.withKeys(V,["enter"])},null,544),[[e.vModelText,m.value]]),e.createElementVNode("button",{onClick:V},"搜索")]),e.unref(o).previewImage?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("div",Pe,[n[9]||(n[9]=e.createElementVNode("label",null,"匹配坐标：",-1)),e.createElementVNode("div",ze,[n[5]||(n[5]=e.createElementVNode("span",{class:"map-coord__info-content-item-label"},"A: ",-1)),e.createElementVNode("span",Ke,"["+e.toDisplayString(e.unref(o).coords.topLeft)+"]",1)]),e.createElementVNode("div",De,[n[6]||(n[6]=e.createElementVNode("span",{class:"map-coord__info-content-item-label"},"B: ",-1)),e.createElementVNode("span",He,"["+e.toDisplayString(e.unref(o).coords.topRight)+"]",1)]),e.createElementVNode("div",Te,[n[7]||(n[7]=e.createElementVNode("span",{class:"map-coord__info-content-item-label"},"C: ",-1)),e.createElementVNode("span",je,"["+e.toDisplayString(e.unref(o).coords.bottomLeft)+"]",1)]),e.createElementVNode("div",Fe,[n[8]||(n[8]=e.createElementVNode("span",{class:"map-coord__info-content-item-label"},"D: ",-1)),e.createElementVNode("span",Ue,"["+e.toDisplayString(e.unref(o).coords.bottomRight)+"]",1)])]),e.createElementVNode("div",Xe,[e.createElementVNode("div",We,[e.createElementVNode("label",null,"旋转角度："+e.toDisplayString(e.unref(o).imgRotation)+"%",1),e.createElementVNode("div",null,[e.createElementVNode("input",{type:"range",min:"-180",max:"180",value:e.unref(o).imgRotation,onInput:oo},null,40,Qe)])]),e.createElementVNode("div",Je,[e.createElementVNode("label",null,"缩放比例："+e.toDisplayString(e.unref(o).imgScale),1),e.createElementVNode("div",null,[e.createElementVNode("input",{type:"range",value:e.unref(o).imgScale,min:.1,max:2.5,step:.05,onInput:to},null,40,Ge)])])])],64)):e.createCommentVNode("",!0)]),A.value?(e.openBlock(),e.createElementBlock("dialog",{key:1,ref_key:"markerLabelDialogRef",ref:g,class:"map-coord__dialog"},[e.createElementVNode("div",Ye,[e.withDirectives(e.createElementVNode("input",{ref_key:"markerLabelInputRef",ref:d,type:"text","onUpdate:modelValue":n[2]||(n[2]=y=>w.value=y),placeholder:"请输入标注名称",maxlength:10,onKeyup:e.withKeys(le,["enter"])},null,544),[[e.vModelText,w.value]]),e.createElementVNode("div",{class:"map-coord__dialog-operate"},[e.createElementVNode("button",{class:"map-coord__dialog-operate__button cancel",onClick:io}," 取消 "),e.createElementVNode("button",{class:"map-coord__dialog-operate__button confirm",onClick:le}," 确定 ")])])],512)):e.createCommentVNode("",!0)])}}});function eo(t){const{el:o}=t,a=e.createApp($e);a.use(de()),a.mount(o)}window.initMapCoordApp=eo})(Vue);
